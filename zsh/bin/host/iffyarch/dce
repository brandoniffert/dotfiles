#!/usr/bin/env bash

set -e

# Find compose.override.yaml in current or ancestor directories
find_override_file() {
  local dir="$PWD"
  while [[ "$dir" != "/" ]]; do
    if [[ -f "$dir/compose.override.yaml" ]]; then
      echo "$dir/compose.override.yaml"
      return 0
    fi

    dir="$(dirname "$dir")"
  done

  return 1
}

# Check for override file and set compose file arguments
compose_args=()

if override_file=$(find_override_file); then
  echo "=> Using override file: $override_file"
  compose_args+=("-f" "$override_file")
fi

docker compose "${compose_args[@]}" exec "$@"
